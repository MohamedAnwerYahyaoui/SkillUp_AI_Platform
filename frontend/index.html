<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkillUp AI Platform</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        const API_BASE = 'http://localhost:8000';

        // Icon Components (simplified versions)
        const Search = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
            </svg>
        );

        const FileText = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="16" y1="13" x2="8" y2="13"></line>
                <line x1="16" y1="17" x2="8" y2="17"></line>
                <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
        );

        const MessageSquare = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
        );

        const AlertTriangle = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path>
                <line x1="12" y1="9" x2="12" y2="13"></line>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
        );

        const TrendingUp = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                <polyline points="17 6 23 6 23 12"></polyline>
            </svg>
        );

        const Loader2 = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="animate-spin">
                <path d="M21 12a9 9 0 1 1-6.219-8.56"></path>
            </svg>
        );

        function SkillUpAI() {
            const [activeTab, setActiveTab] = useState('recommend');
            const [loading, setLoading] = useState(false);
            const [result, setResult] = useState(null);
            const [error, setError] = useState(null);
            const [apprenantId, setApprenantId] = useState('1');
            const [question, setQuestion] = useState('');

            const handleRecommend = async () => {
                setLoading(true);
                setError(null);
                try {
                    const response = await fetch(`${API_BASE}/ai/recommend/${apprenantId}`);
                    const data = await response.json();
                    setResult(data);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            const handleSummarize = async () => {
                setLoading(true);
                setError(null);
                try {
                    const response = await fetch(`${API_BASE}/ai/summarize/${apprenantId}`);
                    const data = await response.json();
                    setResult(data);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            const handleQA = async () => {
                if (!question.trim()) return;
                setLoading(true);
                setError(null);
                try {
                    const response = await fetch(`${API_BASE}/ai/qa/${apprenantId}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ question })
                    });
                    const data = await response.json();
                    setResult(data);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            const handleAttendance = async () => {
                setLoading(true);
                setError(null);
                try {
                    const response = await fetch(`${API_BASE}/ai/attendance/analyze`);
                    const data = await response.json();
                    setResult(data);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            const tabs = [
                { id: 'recommend', label: 'Recommend Formations', icon: TrendingUp },
                { id: 'summarize', label: 'Summarize CV', icon: FileText },
                { id: 'qa', label: 'Q&A Assistant', icon: MessageSquare },
                { id: 'attendance', label: 'Attendance Anomaly', icon: AlertTriangle }
            ];

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50">
                    <div className="container mx-auto px-4 py-8 max-w-6xl">
                        <div className="text-center mb-12">
                            <h1 className="text-5xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-3">
                                SkillUp AI Platform
                            </h1>
                            <p className="text-gray-600 text-lg">Intelligent learning recommendation system</p>
                        </div>

                        <div className="flex flex-wrap gap-2 mb-8 bg-white rounded-xl p-2 shadow-sm">
                            {tabs.map(tab => {
                                const Icon = tab.icon;
                                return (
                                    <button
                                        key={tab.id}
                                        onClick={() => {
                                            setActiveTab(tab.id);
                                            setResult(null);
                                            setError(null);
                                        }}
                                        className={`flex items-center gap-2 px-6 py-3 rounded-lg font-medium transition-all ${
                                            activeTab === tab.id
                                                ? 'bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-md'
                                                : 'text-gray-600 hover:bg-gray-100'
                                        }`}
                                    >
                                        <Icon />
                                        <span className="hidden sm:inline">{tab.label}</span>
                                    </button>
                                );
                            })}
                        </div>

                        <div className="bg-white rounded-2xl shadow-xl p-8">
                            {activeTab === 'recommend' && (
                                <div>
                                    <h2 className="text-2xl font-bold text-gray-800 mb-6">AI Formation Recommendations</h2>
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Apprenant ID</label>
                                            <input
                                                type="number"
                                                value={apprenantId}
                                                onChange={(e) => setApprenantId(e.target.value)}
                                                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                placeholder="Enter apprenant ID"
                                            />
                                        </div>
                                        <button
                                            onClick={handleRecommend}
                                            disabled={loading}
                                            className="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-semibold hover:shadow-lg transition-all disabled:opacity-50 flex items-center justify-center gap-2"
                                        >
                                            {loading ? <Loader2 /> : <Search />}
                                            {loading ? 'Analyzing...' : 'Get Recommendations'}
                                        </button>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'summarize' && (
                                <div>
                                    <h2 className="text-2xl font-bold text-gray-800 mb-6">CV Summarization</h2>
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Apprenant ID</label>
                                            <input
                                                type="number"
                                                value={apprenantId}
                                                onChange={(e) => setApprenantId(e.target.value)}
                                                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                placeholder="Enter apprenant ID"
                                            />
                                        </div>
                                        <button
                                            onClick={handleSummarize}
                                            disabled={loading}
                                            className="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-semibold hover:shadow-lg transition-all disabled:opacity-50 flex items-center justify-center gap-2"
                                        >
                                            {loading ? <Loader2 /> : <FileText />}
                                            {loading ? 'Summarizing...' : 'Summarize CV'}
                                        </button>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'qa' && (
                                <div>
                                    <h2 className="text-2xl font-bold text-gray-800 mb-6">Smart Q&A Assistant</h2>
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Apprenant ID</label>
                                            <input
                                                type="number"
                                                value={apprenantId}
                                                onChange={(e) => setApprenantId(e.target.value)}
                                                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                placeholder="Enter apprenant ID"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Your Question</label>
                                            <textarea
                                                value={question}
                                                onChange={(e) => setQuestion(e.target.value)}
                                                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                placeholder="Ask anything about the apprenant's profile, skills, objectives..."
                                                rows="4"
                                            />
                                        </div>
                                        <button
                                            onClick={handleQA}
                                            disabled={loading || !question.trim()}
                                            className="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-semibold hover:shadow-lg transition-all disabled:opacity-50 flex items-center justify-center gap-2"
                                        >
                                            {loading ? <Loader2 /> : <MessageSquare />}
                                            {loading ? 'Processing...' : 'Ask Question'}
                                        </button>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'attendance' && (
                                <div>
                                    <h2 className="text-2xl font-bold text-gray-800 mb-6">Attendance Anomaly Detection</h2>
                                    <p className="text-gray-600 mb-6">
                                        Detect unusual patterns in learner attendance using ML-based anomaly detection.
                                    </p>
                                    <button
                                        onClick={handleAttendance}
                                        disabled={loading}
                                        className="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-semibold hover:shadow-lg transition-all disabled:opacity-50 flex items-center justify-center gap-2"
                                    >
                                        {loading ? <Loader2 /> : <AlertTriangle />}
                                        {loading ? 'Analyzing...' : 'Detect Anomalies'}
                                    </button>
                                </div>
                            )}

                            {error && (
                                <div className="mt-6 p-4 bg-red-50 border border-red-200 rounded-lg">
                                    <p className="text-red-700 font-medium">Error: {error}</p>
                                    <p className="text-red-600 text-sm mt-1">Make sure your FastAPI backend is running on http://localhost:8000</p>
                                </div>
                            )}

                            {result && !error && (
                                <div className="mt-6 p-6 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl border border-blue-200">
                                    <h3 className="text-lg font-bold text-gray-800 mb-4">Results</h3>
                                    
                                    {result.items && activeTab === 'recommend' && (
                                        <div className="space-y-3">
                                            {result.items.map((item, idx) => (
                                                <div key={idx} className="bg-white p-4 rounded-lg shadow-sm border border-gray-200">
                                                    <div className="flex justify-between items-start">
                                                        <div>
                                                            <p className="font-semibold text-gray-800">Formation ID: {item.formationId}</p>
                                                            <p className="text-sm text-gray-600 mt-1">{item.why}</p>
                                                        </div>
                                                        <div className="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm font-semibold">
                                                            {(item.score * 100).toFixed(1)}%
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}

                                    {result.resume && activeTab === 'summarize' && (
                                        <div className="bg-white p-4 rounded-lg shadow-sm">
                                            <p className="text-gray-800">{result.resume}</p>
                                        </div>
                                    )}

                                    {result.answer && activeTab === 'qa' && (
                                        <div className="bg-white p-4 rounded-lg shadow-sm">
                                            <p className="text-gray-800 font-medium mb-2">Answer:</p>
                                            <p className="text-gray-700">{result.answer}</p>
                                            <p className="text-sm text-gray-500 mt-3">Confidence: {(result.score * 100).toFixed(1)}%</p>
                                        </div>
                                    )}

                                    {result.items && activeTab === 'attendance' && (
                                        <div className="space-y-3">
                                            <p className="text-gray-700 font-medium mb-3">Found {result.count} anomalies</p>
                                            {result.items.map((item, idx) => (
                                                <div key={idx} className="bg-white p-4 rounded-lg shadow-sm border-l-4 border-red-500">
                                                    <div className="flex justify-between items-center">
                                                        <div>
                                                            <p className="font-semibold text-gray-800">Apprenant ID: {item.apprenantId}</p>
                                                            <p className="text-sm text-gray-600">Rank: #{item.rank}</p>
                                                        </div>
                                                        <div className="bg-red-100 text-red-700 px-3 py-1 rounded-full text-sm font-semibold">
                                                            Score: {item.anomaly_score.toFixed(2)}
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}

                                    {!result.items && !result.resume && !result.answer && (
                                        <pre className="bg-white p-4 rounded-lg overflow-auto text-sm">
                                            {JSON.stringify(result, null, 2)}
                                        </pre>
                                    )}
                                </div>
                            )}
                        </div>

                        
                    </div>
                </div>
            );
        }

        ReactDOM.render(<SkillUpAI />, document.getElementById('root'));
    </script>
</body>
</html>